
"""
ë„ì»¤ í™˜ê²½ìœ¼ë¡œ ê°œë°œí•  ë•Œ docker-compose.yml, docker-compose.dev.yml, docker-compose.prod.yml ì™€ ê°™ì´ ì—¬ëŸ¬ê°œì˜ docker-compose ë³„ë„ë¡œ ë§Œë“¤ê³ 
- ë°°í¬ ì„œë²„ë“¤ì„ êµ¬ë™í•˜ë©´ì„œ, ê°œë°œ ì„œë²„ë“¤ì€ ì½”ë“œ ë³€ê²½ì— ë”°ë¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ì  ì—…ë°ì´íŠ¸ê°€ ë˜ë„ë¡ í•˜ë ¤ë©´ ì–´ë–¤ ë°©ë²•ì„ ì¨ì•¼ í•˜ëŠ”ì§€ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì„¸ìš”.
"""

ì •ë§ ì¢‹ì€ ì§ˆë¬¸ì´ë„¤ìš”! Docker í™˜ê²½ì—ì„œ ê°œë°œê³¼ í”„ë¡œë•ì…˜ì„ ë¶„ë¦¬í•˜ë©´ì„œë„ ê°œë°œ íš¨ìœ¨ì„±ì„ ê·¹ëŒ€í™”í•˜ëŠ” êµ¬ì²´ì ì¸ ë°©ë²•ì„ ì•Œë ¤ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## ğŸ³ Multi-Stage Docker Compose êµ¬ì¡°

### 1. **ì „ì²´ Docker Compose íŒŒì¼ êµ¬ì¡°**

```
workspace/
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ docker-compose.yml          # ê¸°ë³¸ ì„¤ì • (ê³µí†µ)
â”‚   â”œâ”€â”€ docker-compose.dev.yml      # ê°œë°œ í™˜ê²½ ì˜¤ë²„ë¼ì´ë“œ
â”‚   â”œâ”€â”€ docker-compose.prod.yml     # í”„ë¡œë•ì…˜ í™˜ê²½ ì˜¤ë²„ë¼ì´ë“œ
â”‚   â”œâ”€â”€ docker-compose.test.yml     # í…ŒìŠ¤íŠ¸ í™˜ê²½ ì˜¤ë²„ë¼ì´ë“œ
â”‚   â””â”€â”€ dockerfiles/
â”‚       â”œâ”€â”€ backend.dev.Dockerfile  # ê°œë°œìš© ë°±ì—”ë“œ
â”‚       â”œâ”€â”€ backend.prod.Dockerfile # í”„ë¡œë•ì…˜ìš© ë°±ì—”ë“œ
â”‚       â”œâ”€â”€ frontend.dev.Dockerfile # ê°œë°œìš© í”„ë¡ íŠ¸ì—”ë“œ
â”‚       â””â”€â”€ frontend.prod.Dockerfile# í”„ë¡œë•ì…˜ìš© í”„ë¡ íŠ¸ì—”ë“œ
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ dev-start.sh               # ê°œë°œ í™˜ê²½ ì‹œì‘
â”‚   â”œâ”€â”€ dev-stop.sh                # ê°œë°œ í™˜ê²½ ì¤‘ì§€
â”‚   â”œâ”€â”€ prod-start.sh              # í”„ë¡œë•ì…˜ í™˜ê²½ ì‹œì‘
â”‚   â”œâ”€â”€ prod-stop.sh               # í”„ë¡œë•ì…˜ í™˜ê²½ ì¤‘ì§€
â”‚   â””â”€â”€ hot-reload.sh              # í•« ë¦¬ë¡œë“œ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ .env.example
```

## ğŸ“‹ ê¸°ë³¸ Docker Compose ì„¤ì •

### 2. **ê¸°ë³¸ docker-compose.yml (ê³µí†µ ì„¤ì •)**

```yaml
version: '3.8'

services:
  # ì¸í”„ë¼ ì„œë¹„ìŠ¤ë“¤ (ê°œë°œ/í”„ë¡œë•ì…˜ ê³µí†µ)
  shared-postgres:
    image: postgres:15
    container_name: shared-postgres
    environment:
      POSTGRES_DB: postgres
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./infrastructure/shared-database/postgresql/init:/docker-entrypoint-initdb.d
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    networks:
      - infrastructure
    restart: unless-stopped

  shared-mysql:
    image: mysql:8.0
    container_name: shared-mysql
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_PASSWORD}
      MYSQL_DATABASE: management
    volumes:
      - mysql_data:/var/lib/mysql
      - ./infrastructure/shared-database/mysql/init:/docker-entrypoint-initdb.d
    ports:
      - "${MYSQL_PORT:-3306}:3306"
    networks:
      - infrastructure
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: shared-redis
    ports:
      - "${REDIS_PORT:-6379}:6379"
    volumes:
      - redis_data:/data
    networks:
      - infrastructure
    restart: unless-stopped

  # ì‚¬ìš©ì ê´€ë¦¬ ì„œë¹„ìŠ¤
  auth-service:
    container_name: auth-service
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      DATABASE_URL: postgresql://postgres:${POSTGRES_PASSWORD}@shared-postgres:5432/auth_db
      REDIS_URL: redis://redis:6379
      JWT_ACCESS_SECRET: ${JWT_ACCESS_SECRET}
      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET}
    depends_on:
      - shared-postgres
      - redis
    ports:
      - "${AUTH_SERVICE_PORT:-201011}:201000"
    networks:
      - infrastructure

  # ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ì„œë¹„ìŠ¤
  database-service:
    container_name: database-service
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      POSTGRES_ADMIN_HOST: shared-postgres
      POSTGRES_ADMIN_USER: postgres
      POSTGRES_ADMIN_PASSWORD: ${POSTGRES_PASSWORD}
      MYSQL_ADMIN_HOST: shared-mysql
      MYSQL_ADMIN_USER: root
      MYSQL_ADMIN_PASSWORD: ${MYSQL_PASSWORD}
    depends_on:
      - shared-postgres
      - shared-mysql
    ports:
      - "${DATABASE_SERVICE_PORT:-3002}:201000"
    networks:
      - infrastructure

  # API ê²Œì´íŠ¸ì›¨ì´
  api-gateway:
    container_name: api-gateway
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      AUTH_SERVICE_URL: http://auth-service:201000
      DATABASE_SERVICE_URL: http://database-service:201000
    depends_on:
      - auth-service
      - database-service
    ports:
      - "${API_GATEWAY_PORT:-201000}2010000"
    networks:
      - infrastructure
      - projects

  # ê´€ë¦¬ í—ˆë¸Œ ë°±ì—”ë“œ
  management-backend:
    container_name: management-backend
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      DATABASE_URL: postgresql://postgres:${POSTGRES_PASSWORD}@shared-postgres:5432/management_db
      API_GATEWAY_URL: http://api-gateway:201000
    depends_on:
      - shared-postgres
      - api-gateway
    ports:
      - "${MANAGEMENT_BACKEND_PORT:-3004}:201000"
    networks:
      - infrastructure

  # ê´€ë¦¬ í—ˆë¸Œ í”„ë¡ íŠ¸ì—”ë“œ
  management-frontend:
    container_name: management-frontend
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      NEXT_PUBLIC_API_REST_URL: http://localhost:${MANAGEMENT_BACKEND_PORT:-3004}
      NEXT_PUBLIC_GATEWAY_URL: http://localhost:${API_GATEWAY_PORT:-201000}
    depends_on:
      - management-backend
    ports:
      - "${MANAGEMENT_FRONTEND_PORT:-3005}:201000"
    networks:
      - infrastructure

volumes:
  postgres_data:
  mysql_data:
  redis_data:

networks:
  infrastructure:
    driver: bridge
  projects:
    driver: bridge
```

## ğŸ”§ ê°œë°œ í™˜ê²½ ì„¤ì •

### 3. **docker-compose.dev.yml (ê°œë°œ í™˜ê²½ ì˜¤ë²„ë¼ì´ë“œ)**

```yaml
version: '3.8'

services:
  # ì¸í”„ë¼ ì„œë¹„ìŠ¤ë“¤ì€ ê°œë°œ ëª¨ë“œë¡œ ì‹¤í–‰
  auth-service:
    build:
      context: ./infrastructure/auth-service
      dockerfile: ../docker/dockerfiles/backend.dev.Dockerfile
    volumes:
      - ./infrastructure/auth-service:/app
      - /app/node_modules
      - auth_node_modules:/app/node_modules  # named volume for node_modules
    environment:
      NODE_ENV: development
      CHOKIDAR_USEPOLLING: 1  # Windows/macOSì—ì„œ íŒŒì¼ ë³€ê²½ ê°ì§€
      WATCHPACK_POLLING: 1
    command: npm run dev
    restart: unless-stopped

  database-service:
    build:
      context: ./infrastructure/database-service
      dockerfile: ../docker/dockerfiles/backend.dev.Dockerfile
    volumes:
      - ./infrastructure/database-service:/app
      - /app/node_modules
      - db_service_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      CHOKIDAR_USEPOLLING: 1
    command: npm run dev
    restart: unless-stopped

  api-gateway:
    build:
      context: ./infrastructure/api-gateway
      dockerfile: ../docker/dockerfiles/backend.dev.Dockerfile
    volumes:
      - ./infrastructure/api-gateway:/app
      - /app/node_modules
      - gateway_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      CHOKIDAR_USEPOLLING: 1
    command: npm run dev
    restart: unless-stopped

  management-backend:
    build:
      context: ./management-hub/backend
      dockerfile: ../../docker/dockerfiles/backend.dev.Dockerfile
    volumes:
      - ./management-hub/backend:/app
      - /app/node_modules
      - mgmt_backend_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      CHOKIDAR_USEPOLLING: 1
    command: npm run dev
    restart: unless-stopped

  management-frontend:
    build:
      context: ./management-hub/frontend
      dockerfile: ../../docker/dockerfiles/frontend.dev.Dockerfile
    volumes:
      - ./management-hub/frontend:/app
      - /app/node_modules
      - /app/.next  # Next.js ë¹Œë“œ ìºì‹œ ì œì™¸
      - mgmt_frontend_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      CHOKIDAR_USEPOLLING: 1
      WATCHPACK_POLLING: 1
      FAST_REFRESH: true
    command: npm run dev
    restart: unless-stopped

  # ê°œë°œ ë„êµ¬ë“¤
  mailhog:  # ì´ë©”ì¼ í…ŒìŠ¤íŠ¸ìš©
    image: mailhog/mailhog:latest
    container_name: mailhog
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI
    networks:
      - infrastructure

  # í”„ë¡œì íŠ¸ ê°œë°œ ì„œë²„ë“¤ (ë™ì  ì¶”ê°€)
  project-1-backend:
    build:
      context: ./projects/project-1/backend
      dockerfile: ../../../docker/dockerfiles/backend.dev.Dockerfile
    container_name: project-1-backend
    volumes:
      - ./projects/project-1/backend:/app
      - /app/node_modules
      - project1_backend_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      PROJECT_ID: project-1
      API_GATEWAY_URL: http://api-gateway:201000
      CHOKIDAR_USEPOLLING: 1
    command: npm run dev
    ports:
      - "4001:4000"
    networks:
      - infrastructure
      - projects
    depends_on:
      - api-gateway
    restart: unless-stopped

  project-1-frontend:
    build:
      context: ./projects/project-1/frontend/nextjs-app
      dockerfile: ../../../../docker/dockerfiles/frontend.dev.Dockerfile
    container_name: project-1-frontend
    volumes:
      - ./projects/project-1/frontend/nextjs-app:/app
      - /app/node_modules
      - /app/.next
      - project1_frontend_node_modules:/app/node_modules
    environment:
      NODE_ENV: development
      NEXT_PUBLIC_API_REST_URL: http://localhost:4001
      CHOKIDAR_USEPOLLING: 1
      WATCHPACK_POLLING: 1
      FAST_REFRESH: true
    command: npm run dev
    ports:
      - "3101:201000"
    networks:
      - projects
    depends_on:
      - project-1-backend
    restart: unless-stopped

volumes:
  # node_modules ì „ìš© ë³¼ë¥¨ (ì„±ëŠ¥ í–¥ìƒ)
  auth_node_modules:
  db_service_node_modules:
  gateway_node_modules:
  mgmt_backend_node_modules:
  mgmt_frontend_node_modules:
  project1_backend_node_modules:
  project1_frontend_node_modules:
```

## ğŸš€ í”„ë¡œë•ì…˜ í™˜ê²½ ì„¤ì •

### 4. **docker-compose.prod.yml (í”„ë¡œë•ì…˜ í™˜ê²½ ì˜¤ë²„ë¼ì´ë“œ)**

```yaml
version: '3.8'

services:
  # í”„ë¡œë•ì…˜ ìµœì í™”ëœ ì„œë¹„ìŠ¤ë“¤
  auth-service:
    build:
      context: ./infrastructure/auth-service
      dockerfile: ../docker/dockerfiles/backend.prod.Dockerfile
      args:
        NODE_ENV: production
    environment:
      NODE_ENV: production
    command: npm start
    restart: always
    # ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì—†ìŒ (ë³´ì•ˆ)
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 512M

  database-service:
    build:
      context: ./infrastructure/database-service
      dockerfile: ../docker/dockerfiles/backend.prod.Dockerfile
    environment:
      NODE_ENV: production
    command: npm start
    restart: always
    deploy:
      resources:
        limits:
          cpus: '0.50'
          memory: 512M

  api-gateway:
    build:
      context: ./infrastructure/api-gateway  
      dockerfile: ../docker/dockerfiles/backend.prod.Dockerfile
    environment:
      NODE_ENV: production
    command: npm start
    restart: always
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G

  management-backend:
    build:
      context: ./management-hub/backend
      dockerfile: ../../docker/dockerfiles/backend.prod.Dockerfile
    environment:
      NODE_ENV: production
    command: npm start
    restart: always

  management-frontend:
    build:
      context: ./management-hub/frontend
      dockerfile: ../../docker/dockerfiles/frontend.prod.Dockerfile
      args:
        NODE_ENV: production
    environment:
      NODE_ENV: production
    command: npm start
    restart: always

  # Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ (í”„ë¡œë•ì…˜ì—ë§Œ)
  nginx:
    image: nginx:alpine
    container_name: nginx-proxy
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./docker/nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./docker/nginx/ssl:/etc/nginx/ssl
    depends_on:
      - management-frontend
      - api-gateway
    networks:
      - infrastructure
    restart: always

  # ëª¨ë‹ˆí„°ë§ (í”„ë¡œë•ì…˜ì—ë§Œ)
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    ports:
      - "9090:9090"
    volumes:
      - ./infrastructure/monitoring/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    networks:
      - infrastructure
    restart: always

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    environment:
      GF_SECURITY_ADMIN_PASSWORD: ${GRAFANA_PASSWORD}
    ports:
      - "3003:201000"
    volumes:
      - grafana_data:/var/lib/grafana
    networks:
      - infrastructure
    restart: always

volumes:
  prometheus_data:
  grafana_data:
```

## ğŸ”¨ ê°œë°œìš© Dockerfileë“¤

### 5. **ë°±ì—”ë“œ ê°œë°œìš© Dockerfile (dockerfiles/backend.dev.Dockerfile)**

```dockerfile
FROM node:18-alpine

# ê°œë°œ ë„êµ¬ ì„¤ì¹˜
RUN apk add --no-cache git python3 make g++

WORKDIR /app

# íŒ¨í‚¤ì§€ íŒŒì¼ ë³µì‚¬ ë° ì„¤ì¹˜
COPY package*.json ./
RUN npm ci --include=dev

# nodemon ì „ì—­ ì„¤ì¹˜ (ê°œë°œìš©)
RUN npm install -g nodemon

# ê°œë°œìš© ì‚¬ìš©ì ìƒì„± (ê¶Œí•œ ë¬¸ì œ ë°©ì§€)
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ (ê°œë°œ ì‹œì—ëŠ” ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¡œ ëŒ€ì²´ë¨)
COPY . .

# ê¶Œí•œ ì„¤ì •
RUN chown -R nextjs:nodejs /app
USER nextjs

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 201000 4000

# ê°œë°œ ì„œë²„ ì‹œì‘ (hot reload ì§€ì›)
CMD ["npm", "run", "dev"]
```

### 6. **í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìš© Dockerfile (dockerfiles/frontend.dev.Dockerfile)**

```dockerfile
FROM node:18-alpine

# ê°œë°œ ë„êµ¬ ì„¤ì¹˜
RUN apk add --no-cache git python3 make g++

WORKDIR /app

# íŒ¨í‚¤ì§€ íŒŒì¼ ë³µì‚¬ ë° ì„¤ì¹˜
COPY package*.json ./
RUN npm ci --include=dev

# Next.js ìºì‹œ ë””ë ‰í† ë¦¬ ìƒì„±
RUN mkdir -p .next

# ê°œë°œìš© ì‚¬ìš©ì ìƒì„±
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .

# ê¶Œí•œ ì„¤ì •
RUN chown -R nextjs:nodejs /app
USER nextjs

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 201000

# Next.js ê°œë°œ ì„œë²„ ì‹œì‘ (Fast Refresh ì§€ì›)
CMD ["npm", "run", "dev"]
```

## ğŸš€ í”„ë¡œë•ì…˜ìš© Dockerfileë“¤

### 7. **ë°±ì—”ë“œ í”„ë¡œë•ì…˜ìš© Dockerfile (dockerfiles/backend.prod.Dockerfile)**

```dockerfile
# Multi-stage build
FROM node:18-alpine AS builder

WORKDIR /app

# íŒ¨í‚¤ì§€ íŒŒì¼ ë³µì‚¬ ë° í”„ë¡œë•ì…˜ ì˜ì¡´ì„± ì„¤ì¹˜
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬
COPY . .

# í”„ë¡œë•ì…˜ ë‹¨ê³„
FROM node:18-alpine AS runner

# ë³´ì•ˆì„ ìœ„í•œ non-root ì‚¬ìš©ì ìƒì„±
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nodejs -u 1001

WORKDIR /app

# ë¹Œë“œëœ ì•±ê³¼ ì˜ì¡´ì„± ë³µì‚¬
COPY --from=builder --chown=nodejs:nodejs /app/node_modules ./node_modules
COPY --from=builder --chown=nodejs:nodejs /app .

USER nodejs

EXPOSE 201000

# í”„ë¡œë•ì…˜ ëª¨ë“œë¡œ ì‹¤í–‰
CMD ["npm", "start"]
```

### 8. **í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œë•ì…˜ìš© Dockerfile (dockerfiles/frontend.prod.Dockerfile)**

```dockerfile
# Multi-stage build
FROM node:18-alpine AS dependencies

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

# ë¹Œë“œ ë‹¨ê³„
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci

COPY . .

# Next.js ë¹Œë“œ
RUN npm run build

# ëŸ°íƒ€ì„ ë‹¨ê³„
FROM node:18-alpine AS runner

# ë³´ì•ˆì„ ìœ„í•œ non-root ì‚¬ìš©ì
RUN addgroup -g 1001 -S nodejs
RUN adduser -S nextjs -u 1001

WORKDIR /app

# í•„ìš”í•œ íŒŒì¼ë“¤ë§Œ ë³µì‚¬
COPY --from=builder /app/public ./public
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 201000

ENV PORT 201000

CMD ["node", "server.js"]
```

## ğŸ›ï¸ ìŠ¤í¬ë¦½íŠ¸ ìë™í™”

### 9. **ê°œë°œ í™˜ê²½ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ (scripts/dev-start.sh)**

```bash
#!/bin/bash

set -e

echo "ğŸš€ ê°œë°œ í™˜ê²½ì„ ì‹œì‘í•©ë‹ˆë‹¤..."

# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ í™•ì¸
if [ ! -f .env ]; then
    echo "âš ï¸  .env íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. .env.exampleì„ ë³µì‚¬í•´ì£¼ì„¸ìš”."
    cp .env.example .env
    echo "ğŸ“ .env íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í•„ìš”í•œ ì„¤ì •ì„ ìˆ˜ì •í•´ì£¼ì„¸ìš”."
fi

# Docker ë„¤íŠ¸ì›Œí¬ ìƒì„± (ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°)
docker network create projects 2>/dev/null || echo "ğŸ“¡ projects ë„¤íŠ¸ì›Œí¬ê°€ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."

# ê°œë°œ í™˜ê²½ ì‹œì‘
echo "ğŸ”§ ì¸í”„ë¼ ì„œë¹„ìŠ¤ë“¤ì„ ì‹œì‘í•©ë‹ˆë‹¤..."
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.dev.yml \
  up -d shared-postgres shared-mysql redis

echo "â³ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤..."
sleep 10

echo "ğŸ› ï¸  ì¸í”„ë¼ ì„œë¹„ìŠ¤ë“¤ì„ ì‹œì‘í•©ë‹ˆë‹¤..."
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.dev.yml \
  up -d auth-service database-service api-gateway

echo "â³ ì¸í”„ë¼ ì„œë¹„ìŠ¤ê°€ ì¤€ë¹„ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•©ë‹ˆë‹¤..."
sleep 15

echo "ğŸ“Š ê´€ë¦¬ í—ˆë¸Œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.dev.yml \
  up -d management-backend management-frontend

echo "ğŸ¯ í”„ë¡œì íŠ¸ ê°œë°œ ì„œë²„ë“¤ì„ ì‹œì‘í•©ë‹ˆë‹¤..."
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.dev.yml \
  up -d project-1-backend project-1-frontend

echo "âœ… ê°œë°œ í™˜ê²½ì´ ì„±ê³µì ìœ¼ë¡œ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
echo ""
echo "ğŸ“‹ ì„œë¹„ìŠ¤ ì ‘ì† ì •ë³´:"
echo "   ğŸŒ Management Hub: http://localhost:3005"
echo "   ğŸ” API Gateway: http://localhost:201000"
echo "   ğŸ‘¤ Auth Service: http://localhost:201011"
echo "   ğŸ—„ï¸  Database Service: http://localhost:3002"
echo "   ğŸ“§ MailHog: http://localhost:8025"
echo "   ğŸ¯ Project 1 Frontend: http://localhost:3101"
echo "   ğŸ”§ Project 1 Backend: http://localhost:4001"
echo ""
echo "ğŸ“Š ë¡œê·¸ í™•ì¸: docker-compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml logs -f [service-name]"
echo "ğŸ›‘ ì¤‘ì§€: ./scripts/dev-stop.sh"
```

### 10. **í”„ë¡œë•ì…˜ í™˜ê²½ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ (scripts/prod-start.sh)**

```bash
#!/bin/bash

set -e

echo "ğŸš€ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ì‹œì‘í•©ë‹ˆë‹¤..."

# í™˜ê²½ ë³€ìˆ˜ í™•ì¸
if [ ! -f .env.prod ]; then
    echo "âŒ .env.prod íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤."
    exit 1
fi

# í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ ë¹Œë“œ
echo "ğŸ”¨ í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤..."
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.prod.yml \
  --env-file .env.prod \
  build --no-cache

# í”„ë¡œë•ì…˜ í™˜ê²½ ì‹œì‘
echo "ğŸƒ í”„ë¡œë•ì…˜ ì„œë¹„ìŠ¤ë“¤ì„ ì‹œì‘í•©ë‹ˆë‹¤..."
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.prod.yml \
  --env-file .env.prod \
  up -d

echo "âœ… í”„ë¡œë•ì…˜ í™˜ê²½ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
echo "ğŸŒ ì„œë¹„ìŠ¤ ì ‘ì†: https://your-domain.com"
```

### 11. **í•« ë¦¬ë¡œë“œ ìµœì í™” ìŠ¤í¬ë¦½íŠ¸ (scripts/hot-reload.sh)**

```bash
#!/bin/bash

# íŠ¹ì • í”„ë¡œì íŠ¸ì˜ í•« ë¦¬ë¡œë“œ ìµœì í™”
PROJECT_NAME=${1:-"project-1"}

echo "ğŸ”¥ $PROJECT_NAME í•« ë¦¬ë¡œë“œë¥¼ ìµœì í™”í•©ë‹ˆë‹¤..."

# Node.js í”„ë¡œì„¸ìŠ¤ ì¬ì‹œì‘ (ë°±ì—”ë“œ)
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.dev.yml \
  exec ${PROJECT_NAME}-backend npm run restart

# Next.js Fast Refresh í™•ì¸ (í”„ë¡ íŠ¸ì—”ë“œ)
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.dev.yml \
  exec ${PROJECT_NAME}-frontend npm run dev:refresh

echo "âœ… í•« ë¦¬ë¡œë“œê°€ ìµœì í™”ë˜ì—ˆìŠµë‹ˆë‹¤!"
```

## ğŸ”§ ê°œë°œ ìµœì í™” ì„¤ì •

### 12. **package.json ê°œë°œ ìŠ¤í¬ë¦½íŠ¸**

```json
{
  "scripts": {
    "dev": "nodemon --watch src --ext js,json,graphql --exec node src/app.js",
    "dev:debug": "nodemon --inspect=0.0.0.0:9229 --watch src --ext js,json,graphql --exec node src/app.js",
    "dev:refresh": "kill -USR2 $(pgrep -f 'node.*src/app.js') 2>/dev/null || echo 'Process not found'",
    "start": "node src/app.js",
    "restart": "npm run dev"
  },
  "nodemonConfig": {
    "watch": ["src"],
    "ext": "js,json,graphql",
    "ignore": ["node_modules", "*.test.js"],
    "delay": 1000,
    "env": {
      "NODE_ENV": "development"
    }
  }
}
```

### 13. **Next.js ê°œë°œ ì„¤ì • (next.config.js)**

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // ê°œë°œ í™˜ê²½ì—ì„œë§Œ Fast Refresh í™œì„±í™”
  ...(process.env.NODE_ENV === 'development' && {
    experimental: {
      fastRefresh: true,
    },
    webpack: (config, { dev, isServer }) => {
      if (dev && !isServer) {
        // í•« ë¦¬ë¡œë“œ ìµœì í™”
        config.watchOptions = {
          poll: 1000,
          aggregateTimeout: 300,
        };
      }
      return config;
    },
  }),

  // í”„ë¡œë•ì…˜ ìµœì í™”
  ...(process.env.NODE_ENV === 'production' && {
    output: 'standalone',
    compress: true,
    poweredByHeader: false,
  }),

  env: {
    CUSTOM_KEY: process.env.CUSTOM_KEY,
  },
};

module.exports = nextConfig;
```

### 14. **í™˜ê²½ë³„ ì‹¤í–‰ ëª…ë ¹ì–´**

```bash
# ê°œë°œ í™˜ê²½
./scripts/dev-start.sh

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì¬ì‹œì‘
docker-compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml restart project-1-backend

# ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
docker-compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml logs -f project-1-backend

# í”„ë¡œë•ì…˜ í™˜ê²½
./scripts/prod-start.sh

# ê°œë°œ í™˜ê²½ ì¤‘ì§€
./scripts/dev-stop.sh

# í”„ë¡œë•ì…˜ í™˜ê²½ ì¤‘ì§€
./scripts/prod-stop.sh
```

## ğŸ¯ í•µì‹¬ í¬ì¸íŠ¸

### **ê°œë°œ í™˜ê²½ì—ì„œì˜ í•« ë¦¬ë¡œë“œ ë³´ì¥:**

1. **ë³¼ë¥¨ ë§ˆìš´íŒ…**: ì†ŒìŠ¤ ì½”ë“œë¥¼ ì»¨í…Œì´ë„ˆì— ë§ˆìš´íŠ¸
2. **Named Volumes**: `node_modules`ë¥¼ ë³„ë„ ë³¼ë¥¨ìœ¼ë¡œ ë¶„ë¦¬ (ì„±ëŠ¥ í–¥ìƒ)
3. **íŒŒì¼ ê°ì‹œ**: `CHOKIDAR_USEPOLLING=1`ë¡œ íŒŒì¼ ë³€ê²½ ê°ì§€
4. **ê°œë°œ ë„êµ¬**: nodemon, Next.js Fast Refresh í™œìš©
5. **ë‹¨ê³„ë³„ ì‹œì‘**: ì˜ì¡´ì„± ìˆœì„œì— ë”°ë¥¸ ì„œë¹„ìŠ¤ ì‹œì‘

### **í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œì˜ ìµœì í™”:**

1. **Multi-stage Build**: ë¹Œë“œì™€ ëŸ°íƒ€ì„ ë¶„ë¦¬
2. **ë³´ì•ˆ ê°•í™”**: non-root ì‚¬ìš©ì, ë¶ˆí•„ìš”í•œ íŒ¨í‚¤ì§€ ì œê±°
3. **ë¦¬ì†ŒìŠ¤ ì œí•œ**: CPU, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì œí•œ
4. **ëª¨ë‹ˆí„°ë§**: Prometheus, Grafana ì¶”ê°€
5. **ë¡œë“œ ë°¸ëŸ°ì‹±**: Nginx ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ

ì´ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´ ê°œë°œ ì‹œì—ëŠ” ì½”ë“œ ë³€ê²½ì´ ì¦‰ì‹œ ë°˜ì˜ë˜ë©´ì„œë„, í”„ë¡œë•ì…˜ì—ì„œëŠ” ìµœì í™”ëœ í™˜ê²½ì„ ìœ ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

===

"""
docker-compose íŒŒì¼ì—ì„œ ë™ì¼í•œ ë””ë ‰í† ë¦¬ì— ìˆì§€ ì•Šì€ .env ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?
ì˜ˆë¥¼ ë“¤ì–´ ì•„ë˜ì™€ ê°™ë‹¤ë©´

â”œâ”€â”€ docker/                           # Docker ê´€ë ¨ íŒŒì¼ë“¤
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ docker-compose.dev.yml
â”‚   â”œâ”€â”€ docker-compose.prod.yml

...

â”œâ”€â”€ environments/                    # í™˜ê²½ë³„ ì„¤ì •
â”‚   â”œâ”€â”€ development/.env
â”‚   â”œâ”€â”€ staging/
â”‚   â””â”€â”€ production/.env
"""

ë„¤! ë™ì¼í•œ ë””ë ‰í† ë¦¬ì— ìˆì§€ ì•Šì€ `.env` íŒŒì¼ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ì´ ìˆì–´ì„œ ìƒí™©ì— ë§ê²Œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.

## ğŸ¯ ë°©ë²•ë³„ ìƒì„¸ ì„¤ëª…

### 1. **--env-file ì˜µì…˜ ì‚¬ìš© (ê°€ì¥ ì¶”ì²œ)**

#### **ëª…ë ¹ì–´ì—ì„œ ì§ì ‘ ì§€ì •:**
```bash
# ê°œë°œ í™˜ê²½
docker-compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml --env-file environments/development/.env up -d

# í”„ë¡œë•ì…˜ í™˜ê²½
docker-compose -f docker/docker-compose.yml -f docker/docker-compose.prod.yml --env-file environments/production/.env up -d

# ì—¬ëŸ¬ .env íŒŒì¼ ì‚¬ìš© (ìˆœì„œëŒ€ë¡œ ì ìš©ë¨)
docker-compose -f docker/docker-compose.yml -f docker/docker-compose.dev.yml --env-file environments/common/.env --env-file environments/development/.env up -d
```

### 2. **ìŠ¤í¬ë¦½íŠ¸ë¡œ ìë™í™” (ìµœê³  ì¶”ì²œ)**

#### **ê°œë°œ í™˜ê²½ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ (scripts/dev-start.sh)**
```bash
#!/bin/bash

set -e

echo "ğŸš€ ê°œë°œ í™˜ê²½ì„ ì‹œì‘í•©ë‹ˆë‹¤..."

# ì‘ì—… ë””ë ‰í† ë¦¬ë¥¼ í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ë³€ê²½
cd "$(dirname "$0")/.."

# í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ í™•ì¸
ENV_FILE="environments/development/.env"
if [ ! -f "$ENV_FILE" ]; then
    echo "âŒ $ENV_FILE íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."
    exit 1
fi

echo "ğŸ“ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ: $ENV_FILE"

# Docker Compose ì‹¤í–‰
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.dev.yml \
  --env-file "$ENV_FILE" \
  up -d

echo "âœ… ê°œë°œ í™˜ê²½ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
```

#### **í”„ë¡œë•ì…˜ í™˜ê²½ ì‹œì‘ ìŠ¤í¬ë¦½íŠ¸ (scripts/prod-start.sh)**
```bash
#!/bin/bash

set -e

echo "ğŸš€ í”„ë¡œë•ì…˜ í™˜ê²½ì„ ì‹œì‘í•©ë‹ˆë‹¤..."

cd "$(dirname "$0")/.."

ENV_FILE="environments/production/.env"
if [ ! -f "$ENV_FILE" ]; then
    echo "âŒ $ENV_FILE íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤."
    exit 1
fi

echo "ğŸ“ í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ: $ENV_FILE"

# í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ ë¹Œë“œ
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.prod.yml \
  --env-file "$ENV_FILE" \
  build --no-cache

# í”„ë¡œë•ì…˜ í™˜ê²½ ì‹œì‘
docker-compose \
  -f docker/docker-compose.yml \
  -f docker/docker-compose.prod.yml \
  --env-file "$ENV_FILE" \
  up -d

echo "âœ… í”„ë¡œë•ì…˜ í™˜ê²½ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
```

### 3. **í™˜ê²½ë³„ .env íŒŒì¼ êµ¬ì¡°**

#### **ê³µí†µ í™˜ê²½ ë³€ìˆ˜ (environments/common/.env)**
```bash
# ê³µí†µ ì„¤ì •
COMPOSE_PROJECT_NAME=workspace
COMPOSE_FILE=docker/docker-compose.yml

# ë°ì´í„°ë² ì´ìŠ¤ ê³µí†µ ì„¤ì •
POSTGRES_USER=postgres
MYSQL_USER=root

# Redis ì„¤ì •
REDIS_PORT=6379

# JWT ê³µí†µ ì„¤ì • (ì‹¤ì œë¡œëŠ” í™˜ê²½ë³„ë¡œ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì•¼ í•¨)
JWT_ACCESS_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d
```

#### **ê°œë°œ í™˜ê²½ (environments/development/.env)**
```bash
# í™˜ê²½ ì‹ë³„
NODE_ENV=development
ENVIRONMENT=development

# í¬íŠ¸ ì„¤ì • (ê°œë°œìš©)
API_GATEWAY_PORT=201000
AUTH_SERVICE_PORT=201011
DATABASE_SERVICE_PORT=3002
MANAGEMENT_BACKEND_PORT=3004
MANAGEMENT_FRONTEND_PORT=3005

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (ê°œë°œìš©)
POSTGRES_PASSWORD=dev_password
POSTGRES_PORT=5432
MYSQL_PASSWORD=dev_password
MYSQL_PORT=3306

# JWT ì‹œí¬ë¦¿ (ê°œë°œìš© - ê°„ë‹¨í•œ ê°’)
JWT_ACCESS_SECRET=dev_access_secret_key_12345
JWT_REFRESH_SECRET=dev_refresh_secret_key_12345

# ì™¸ë¶€ ì„œë¹„ìŠ¤ (ê°œë°œìš©)
EMAIL_SERVICE_URL=http://mailhog:1025
REDIS_URL=redis://redis:6379

# ê°œë°œ ë„êµ¬
CHOKIDAR_USEPOLLING=1
WATCHPACK_POLLING=1
FAST_REFRESH=true

# ë¡œê¹…
LOG_LEVEL=debug
```

#### **í”„ë¡œë•ì…˜ í™˜ê²½ (environments/production/.env)**
```bash
# í™˜ê²½ ì‹ë³„
NODE_ENV=production
ENVIRONMENT=production

# í¬íŠ¸ ì„¤ì • (í”„ë¡œë•ì…˜ìš© - ë³´í†µ ë‚´ë¶€ í¬íŠ¸ë§Œ)
API_GATEWAY_PORT=201000
AUTH_SERVICE_PORT=201011
DATABASE_SERVICE_PORT=3002
MANAGEMENT_BACKEND_PORT=3004
MANAGEMENT_FRONTEND_PORT=3005

# ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • (í”„ë¡œë•ì…˜ìš© - ê°•ë ¥í•œ íŒ¨ìŠ¤ì›Œë“œ)
POSTGRES_PASSWORD=super_secure_postgres_password_2024!
POSTGRES_PORT=5432
MYSQL_PASSWORD=super_secure_mysql_password_2024!
MYSQL_PORT=3306

# JWT ì‹œí¬ë¦¿ (í”„ë¡œë•ì…˜ìš© - ë³µì¡í•œ ê°’)
JWT_ACCESS_SECRET=prod_access_very_long_and_complex_secret_key_with_special_chars_!@#$%^&*()
JWT_REFRESH_SECRET=prod_refresh_very_long_and_complex_secret_key_with_special_chars_!@#$%^&*()

# ì™¸ë¶€ ì„œë¹„ìŠ¤ (í”„ë¡œë•ì…˜ìš©)
EMAIL_SERVICE_URL=smtp://your-smtp-server:587
REDIS_URL=redis://redis:6379

# ë³´ì•ˆ ì„¤ì •
CORS_ORIGIN=https://your-domain.com
SECURE_COOKIES=true
HTTPS_ONLY=true

# ëª¨ë‹ˆí„°ë§
GRAFANA_PASSWORD=secure_grafana_password_2024!
PROMETHEUS_RETENTION=30d

# ë¡œê¹…
LOG_LEVEL=info
LOG_FILE=/var/log/app.log
```

### 4. **ê³ ê¸‰ í™˜ê²½ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸**

#### **í†µí•© í™˜ê²½ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸ (scripts/env-manager.sh)**
```bash
#!/bin/bash

set -e

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# í•¨ìˆ˜ë“¤
print_info() {
    echo -e "${BLUE}â„¹ï¸  $1${NC}"
}

print_success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}âš ï¸  $1${NC}"
}

print_error() {
    echo -e "${RED}âŒ $1${NC}"
}

# ì‚¬ìš©ë²• ì¶œë ¥
usage() {
    echo "ì‚¬ìš©ë²•: $0 [ENVIRONMENT] [ACTION]"
    echo ""
    echo "ENVIRONMENT:"
    echo "  dev, development    ê°œë°œ í™˜ê²½"
    echo "  staging            ìŠ¤í…Œì´ì§• í™˜ê²½"
    echo "  prod, production   í”„ë¡œë•ì…˜ í™˜ê²½"
    echo ""
    echo "ACTION:"
    echo "  up                 ì„œë¹„ìŠ¤ ì‹œì‘"
    echo "  down               ì„œë¹„ìŠ¤ ì¤‘ì§€"
    echo "  restart            ì„œë¹„ìŠ¤ ì¬ì‹œì‘"
    echo "  logs               ë¡œê·¸ í™•ì¸"
    echo "  ps                 ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸"
    echo "  build             ì´ë¯¸ì§€ ë¹Œë“œ"
    echo ""
    echo "ì˜ˆì‹œ:"
    echo "  $0 dev up          ê°œë°œ í™˜ê²½ ì‹œì‘"
    echo "  $0 prod build      í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ ë¹Œë“œ"
    echo "  $0 staging logs    ìŠ¤í…Œì´ì§• ë¡œê·¸ í™•ì¸"
}

# í™˜ê²½ ì„¤ì •
setup_environment() {
    local env=$1
    
    case $env in
        "dev"|"development")
            ENV_NAME="development"
            COMPOSE_FILES="-f docker/docker-compose.yml -f docker/docker-compose.dev.yml"
            ;;
        "staging")
            ENV_NAME="staging"
            COMPOSE_FILES="-f docker/docker-compose.yml -f docker/docker-compose.staging.yml"
            ;;
        "prod"|"production")
            ENV_NAME="production"
            COMPOSE_FILES="-f docker/docker-compose.yml -f docker/docker-compose.prod.yml"
            ;;
        *)
            print_error "ì§€ì›í•˜ì§€ ì•ŠëŠ” í™˜ê²½: $env"
            usage
            exit 1
            ;;
    esac
    
    ENV_FILE="environments/${ENV_NAME}/.env"
    
    if [ ! -f "$ENV_FILE" ]; then
        print_error "í™˜ê²½ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤: $ENV_FILE"
        exit 1
    fi
    
    print_info "í™˜ê²½: $ENV_NAME"
    print_info "ì„¤ì • íŒŒì¼: $ENV_FILE"
}

# Docker Compose ëª…ë ¹ ì‹¤í–‰
run_docker_compose() {
    local action=$1
    shift
    
    print_info "Docker Compose ì‹¤í–‰: $action"
    
    docker-compose $COMPOSE_FILES --env-file "$ENV_FILE" $action "$@"
}

# ë©”ì¸ ë¡œì§
main() {
    if [ $# -lt 2 ]; then
        usage
        exit 1
    fi
    
    local environment=$1
    local action=$2
    shift 2
    
    # í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™
    cd "$(dirname "$0")/.."
    
    # í™˜ê²½ ì„¤ì •
    setup_environment "$environment"
    
    case $action in
        "up")
            print_info "ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
            run_docker_compose up -d "$@"
            print_success "ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
            ;;
        "down")
            print_info "ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•©ë‹ˆë‹¤..."
            run_docker_compose down "$@"
            print_success "ì„œë¹„ìŠ¤ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!"
            ;;
        "restart")
            print_info "ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘í•©ë‹ˆë‹¤..."
            run_docker_compose restart "$@"
            print_success "ì„œë¹„ìŠ¤ê°€ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
            ;;
        "logs")
            print_info "ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤..."
            run_docker_compose logs -f "$@"
            ;;
        "ps")
            print_info "ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤..."
            run_docker_compose ps "$@"
            ;;
        "build")
            print_info "ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤..."
            run_docker_compose build --no-cache "$@"
            print_success "ì´ë¯¸ì§€ ë¹Œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
            ;;
        "exec")
            if [ $# -lt 1 ]; then
                print_error "ì„œë¹„ìŠ¤ ì´ë¦„ì´ í•„ìš”í•©ë‹ˆë‹¤."
                echo "ì‚¬ìš©ë²•: $0 $environment exec [SERVICE] [COMMAND]"
                exit 1
            fi
            run_docker_compose exec "$@"
            ;;
        *)
            print_error "ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜: $action"
            usage
            exit 1
            ;;
    esac
}

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
main "$@"
```

### 5. **ì‚¬ìš© ì˜ˆì‹œ**

#### **ê°œë°œ í™˜ê²½ ê´€ë¦¬:**
```bash
# ê¶Œí•œ ë¶€ì—¬ (ìµœì´ˆ 1íšŒ)
chmod +x scripts/env-manager.sh

# ê°œë°œ í™˜ê²½ ì‹œì‘
./scripts/env-manager.sh dev up

# íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì‹œì‘
./scripts/env-manager.sh dev up auth-service management-frontend

# ê°œë°œ í™˜ê²½ ë¡œê·¸ í™•ì¸
./scripts/env-manager.sh dev logs

# íŠ¹ì • ì„œë¹„ìŠ¤ ë¡œê·¸ í™•ì¸
./scripts/env-manager.sh dev logs auth-service

# ê°œë°œ í™˜ê²½ ì¤‘ì§€
./scripts/env-manager.sh dev down
```

#### **í”„ë¡œë•ì…˜ í™˜ê²½ ê´€ë¦¬:**
```bash
# í”„ë¡œë•ì…˜ ì´ë¯¸ì§€ ë¹Œë“œ
./scripts/env-manager.sh prod build

# í”„ë¡œë•ì…˜ í™˜ê²½ ì‹œì‘
./scripts/env-manager.sh prod up

# í”„ë¡œë•ì…˜ ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
./scripts/env-manager.sh prod ps

# í”„ë¡œë•ì…˜ í™˜ê²½ ë¡œê·¸ í™•ì¸ (ì—ëŸ¬ë§Œ)
./scripts/env-manager.sh prod logs --tail=100 | grep ERROR
```

### 6. **Docker Compose íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš© ì˜ˆì‹œ**

#### **docker-compose.ymlì—ì„œì˜ í™œìš©:**
```yaml
version: '3.8'

services:
  auth-service:
    container_name: auth-service
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      DATABASE_URL: postgresql://postgres:${POSTGRES_PASSWORD}@shared-postgres:5432/auth_db
      JWT_ACCESS_SECRET: ${JWT_ACCESS_SECRET}
      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET}
    ports:
      - "${AUTH_SERVICE_PORT:-201011}:201000"
    
  management-frontend:
    container_name: management-frontend
    environment:
      NODE_ENV: ${NODE_ENV:-development}
      NEXT_PUBLIC_API_REST_URL: ${NEXT_PUBLIC_API_REST_URL:-http://localhost:3004}
      NEXT_PUBLIC_GATEWAY_URL: ${NEXT_PUBLIC_GATEWAY_URL:-http://localhost:201000}
    ports:
      - "${MANAGEMENT_FRONTEND_PORT:-3005}:201000"
```

## ğŸ¯ ì¶”ì²œí•˜ëŠ” ë°©ë²•

**ê°€ì¥ ì‹¤ìš©ì ì¸ ì¡°í•©:**
1. **í™˜ê²½ë³„ .env íŒŒì¼** êµ¬ì¡°í™”
2. **í†µí•© ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸** ì‚¬ìš©
3. **--env-file ì˜µì…˜** í™œìš©

ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´:
- âœ… í™˜ê²½ë³„ ì„¤ì •ì´ ëª…í™•íˆ ë¶„ë¦¬ë¨
- âœ… í•œ ë²ˆì˜ ëª…ë ¹ìœ¼ë¡œ ì‰½ê²Œ í™˜ê²½ ì „í™˜ ê°€ëŠ¥
- âœ… ì‹¤ìˆ˜ ë°©ì§€ (ì˜ëª»ëœ í™˜ê²½ì— ë°°í¬í•˜ëŠ” ê²ƒ ë“±)
- âœ… íŒ€ì›ë“¤ì´ ì¼ê´€ëœ ë°©ì‹ìœ¼ë¡œ í™˜ê²½ ê´€ë¦¬ ê°€ëŠ¥

íŠ¹íˆ `scripts/env-manager.sh` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë³µì¡í•œ Docker Compose ëª…ë ¹ì„ ê¸°ì–µí•  í•„ìš” ì—†ì´ ê°„ë‹¨í•˜ê²Œ í™˜ê²½ì„ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”!

===

"""
staging ì€ ì–´ë–¤ ë‹¨ê³„ì¸ê°€ìš”? stagingì´ development, productionê³¼ì˜ ì°¨ë³„ì ì€?
"""

ì •ë§ ì¢‹ì€ ì§ˆë¬¸ì´ë„¤ìš”! **Staging** í™˜ê²½ì€ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œì—ì„œ ë§¤ìš° ì¤‘ìš”í•œ ë‹¨ê³„ì¸ë°, ë§ì€ ê°œë°œìë“¤ì´ í—·ê°ˆë ¤í•˜ëŠ” ë¶€ë¶„ì´ì—ìš”. ê° í™˜ê²½ì˜ ëª©ì ê³¼ ì°¨ì´ì ì„ ëª…í™•íˆ ì„¤ëª…í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## ğŸ¯ ê°œë°œ ë‹¨ê³„ë³„ í™˜ê²½ ê°œìš”

### **í™˜ê²½ë³„ ì—­í• ê³¼ ëª©ì **

```
ê°œë°œì ë¡œì»¬ â†’ Development â†’ Staging â†’ Production
    â†“              â†“           â†“         â†“
  ê°œì¸ ê°œë°œ    â†’  í†µí•© ê°œë°œ  â†’  ì‹¤ì œ í…ŒìŠ¤íŠ¸ â†’ ì‹¤ì œ ì„œë¹„ìŠ¤
```

## ğŸ”§ Development í™˜ê²½

### **ëª©ì :**
- **ê°œë°œìë“¤ì˜ í˜‘ì—… ê³µê°„**
- **ê¸°ëŠ¥ í†µí•© ë° ì´ˆê¸° í…ŒìŠ¤íŠ¸**
- **ë¹ ë¥¸ ê°œë°œ ì‚¬ì´í´ ì§€ì›**

### **íŠ¹ì§•:**
```yaml
# environments/development/.env
NODE_ENV=development
ENVIRONMENT=development

# ê°œë°œ í¸ì˜ì„± ìš°ì„ 
LOG_LEVEL=debug
CHOKIDAR_USEPOLLING=1  # í•« ë¦¬ë¡œë“œ
FAST_REFRESH=true

# ì•½í•œ ë³´ì•ˆ (ê°œë°œ í¸ì˜ì„±)
JWT_ACCESS_SECRET=simple_dev_secret
CORS_ORIGIN=*
SECURE_COOKIES=false

# ê°œë°œìš© ì„œë¹„ìŠ¤
EMAIL_SERVICE_URL=http://mailhog:1025  # ê°€ì§œ ì´ë©”ì¼
DATABASE_URL=postgresql://postgres:dev_password@localhost:5432/dev_db

# ì™¸ë¶€ API ëª¨í‚¹
PAYMENT_SERVICE_URL=http://mock-payment:201000
```

### **ì‚¬ìš© ì‚¬ë¡€:**
- ê°œë°œëœ ê¸°ëŠ¥ë“¤ì„ í†µí•©í•˜ì—¬ í…ŒìŠ¤íŠ¸
- ë‹¤ë¥¸ ê°œë°œìì˜ ì½”ë“œì™€ ì¶©ëŒ í™•ì¸
- ê¸°ë³¸ì ì¸ ê¸°ëŠ¥ ë™ì‘ í™•ì¸
- API ì—°ë™ í…ŒìŠ¤íŠ¸

## ğŸ§ª Staging í™˜ê²½

### **ëª©ì :**
- **Production í™˜ê²½ì˜ ì™„ë²½í•œ ë³µì œí’ˆ**
- **ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œì˜ ìµœì¢… í…ŒìŠ¤íŠ¸**
- **ë°°í¬ ì „ ë§ˆì§€ë§‰ ê²€ì¦ ë‹¨ê³„**

### **íŠ¹ì§•:**
```yaml
# environments/staging/.env
NODE_ENV=production  # ì£¼ëª©! production ëª¨ë“œë¡œ ì‹¤í–‰
ENVIRONMENT=staging

# Productionê³¼ ë™ì¼í•œ ì„¤ì • (ë‹¨, ë°ì´í„°ë§Œ ë‹¤ë¦„)
LOG_LEVEL=info
SECURE_COOKIES=true
HTTPS_ONLY=true

# Productionê¸‰ ë³´ì•ˆ
JWT_ACCESS_SECRET=staging_very_complex_secret_key_!@#$%
CORS_ORIGIN=https://staging.yourdomain.com

# ì‹¤ì œ ì„œë¹„ìŠ¤ì™€ ìœ ì‚¬í•œ ì™¸ë¶€ ì—°ë™ (í…ŒìŠ¤íŠ¸ ê³„ì •)
EMAIL_SERVICE_URL=smtp://test-smtp.yourdomain.com:587
PAYMENT_SERVICE_URL=https://sandbox.payment-provider.com

# Productionê³¼ ë™ì¼í•œ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡° (ë‹¤ë¥¸ ë°ì´í„°)
DATABASE_URL=postgresql://postgres:staging_password@staging-db:5432/staging_db

# Production ë¯¸ëŸ¬ë§
REDIS_URL=redis://staging-redis:6379
MONITORING_ENABLED=true
```

### **í•µì‹¬ ì°¨ë³„ì :**
1. **Productionê³¼ ë™ì¼í•œ ì¸í”„ë¼ êµ¬ì¡°**
2. **ì‹¤ì œ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ (í…ŒìŠ¤íŠ¸ ê³„ì •)**
3. **Production ë ˆë²¨ì˜ ë³´ì•ˆ ì„¤ì •**
4. **ì‹¤ì œ ë°°í¬ í”„ë¡œì„¸ìŠ¤ ê²€ì¦**

## ğŸš€ Production í™˜ê²½

### **ëª©ì :**
- **ì‹¤ì œ ì‚¬ìš©ìì—ê²Œ ì„œë¹„ìŠ¤ ì œê³µ**
- **ìµœê³  ìˆ˜ì¤€ì˜ ì•ˆì •ì„±ê³¼ ì„±ëŠ¥**
- **ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë°ì´í„° ì²˜ë¦¬**

### **íŠ¹ì§•:**
```yaml
# environments/production/.env
NODE_ENV=production
ENVIRONMENT=production

# ìµœì í™”ëœ ì„±ëŠ¥ ì„¤ì •
LOG_LEVEL=warn
CACHE_ENABLED=true
COMPRESSION_ENABLED=true

# ìµœê³  ìˆ˜ì¤€ì˜ ë³´ì•ˆ
JWT_ACCESS_SECRET=production_ultra_secure_secret_key_with_rotation
CORS_ORIGIN=https://yourdomain.com
SECURE_COOKIES=true
HTTPS_ONLY=true
HSTS_ENABLED=true

# ì‹¤ì œ ì™¸ë¶€ ì„œë¹„ìŠ¤
EMAIL_SERVICE_URL=smtp://smtp.yourdomain.com:587
PAYMENT_SERVICE_URL=https://api.payment-provider.com

# ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤
DATABASE_URL=postgresql://postgres:ultra_secure_password@prod-db:5432/production_db

# ê³ ê¸‰ ëª¨ë‹ˆí„°ë§
MONITORING_ENABLED=true
METRICS_ENABLED=true
ALERTING_ENABLED=true
```

## ğŸ“Š í™˜ê²½ë³„ ìƒì„¸ ë¹„êµí‘œ

| í•­ëª© | Development | Staging | Production |
|------|-------------|---------|------------|
| **ëª©ì ** | ê°œë°œ/í†µí•© í…ŒìŠ¤íŠ¸ | ìµœì¢… ê²€ì¦ | ì‹¤ì œ ì„œë¹„ìŠ¤ |
| **ë°ì´í„°** | ê°€ì§œ/í…ŒìŠ¤íŠ¸ ë°ì´í„° | ì‹¤ì œì™€ ìœ ì‚¬í•œ í…ŒìŠ¤íŠ¸ ë°ì´í„° | ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„° |
| **ì™¸ë¶€ API** | Mock/ê°€ì§œ ì„œë¹„ìŠ¤ | Sandbox/í…ŒìŠ¤íŠ¸ ê³„ì • | ì‹¤ì œ ì„œë¹„ìŠ¤ |
| **ë³´ì•ˆ ìˆ˜ì¤€** | ë‚®ìŒ (í¸ì˜ì„± ìš°ì„ ) | ë†’ìŒ (Production ìˆ˜ì¤€) | ìµœê³  |
| **ì„±ëŠ¥** | ë‚®ìŒ (ê°œë°œ ë„êµ¬ ë§ìŒ) | ë†’ìŒ (Production ìœ ì‚¬) | ìµœê³  |
| **ëª¨ë‹ˆí„°ë§** | ê¸°ë³¸ì  | ìƒì„¸í•¨ | ì™„ì „í•¨ |
| **ë°°í¬ ë¹ˆë„** | ë§¤ìš° ë†’ìŒ (ìˆ˜ì‹œë¡œ) | ë³´í†µ (ë¦´ë¦¬ìŠ¤ ì „) | ë‚®ìŒ (ì•ˆì •ì ì¼ ë•Œë§Œ) |
| **ë‹¤ìš´íƒ€ì„** | ìƒê´€ì—†ìŒ | ì–´ëŠ ì •ë„ í—ˆìš© | ì ˆëŒ€ ì•ˆë¨ |

## ğŸ”„ ì‹¤ì œ ê°œë°œ ì›Œí¬í”Œë¡œìš°

### **ì¼ë°˜ì ì¸ ê°œë°œ í”„ë¡œì„¸ìŠ¤:**

```
1. ë¡œì»¬ ê°œë°œ
   â†“
2. Development í™˜ê²½ì— ë°°í¬
   â”œâ”€ ê¸°ëŠ¥ í†µí•© í…ŒìŠ¤íŠ¸
   â”œâ”€ ë‹¤ë¥¸ ê°œë°œìì™€ì˜ í˜‘ì—… í™•ì¸
   â””â”€ ê¸°ë³¸ì ì¸ QA
   â†“
3. Staging í™˜ê²½ì— ë°°í¬
   â”œâ”€ Production í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜
   â”œâ”€ ì‹¤ì œ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ í…ŒìŠ¤íŠ¸
   â”œâ”€ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
   â”œâ”€ ë³´ì•ˆ í…ŒìŠ¤íŠ¸
   â”œâ”€ ì‚¬ìš©ì ìˆ˜ìš© í…ŒìŠ¤íŠ¸ (UAT)
   â””â”€ ìµœì¢… QA ê²€ì¦
   â†“
4. Production í™˜ê²½ì— ë°°í¬
   â””â”€ ì‹¤ì œ ì„œë¹„ìŠ¤ ì‹œì‘
```

## ğŸ—ï¸ Staging í™˜ê²½ êµ¬ì²´ì  êµ¬í˜„

### **docker-compose.staging.yml**
```yaml
version: '3.8'

services:
  # Stagingì€ Productionê³¼ ê±°ì˜ ë™ì¼í•˜ì§€ë§Œ ë¦¬ì†ŒìŠ¤ëŠ” ì•½ê°„ ì ê²Œ
  auth-service:
    build:
      context: ./infrastructure/auth-service
      dockerfile: ../docker/dockerfiles/backend.prod.Dockerfile  # Production ë¹Œë“œ ì‚¬ìš©
    environment:
      NODE_ENV: production  # ì¤‘ìš”: production ëª¨ë“œ
      ENVIRONMENT: staging
    restart: always
    deploy:
      resources:
        limits:
          cpus: '0.25'      # Productionë³´ë‹¤ ì ì€ ë¦¬ì†ŒìŠ¤
          memory: 256M

  management-frontend:
    build:
      context: ./management-hub/frontend
      dockerfile: ../../docker/dockerfiles/frontend.prod.Dockerfile
    environment:
      NODE_ENV: production
      ENVIRONMENT: staging
      # Staging ì „ìš© URLë“¤
      NEXT_PUBLIC_API_REST_URL: https://staging-api.yourdomain.com
      NEXT_PUBLIC_GATEWAY_URL: https://staging.yourdomain.com
    restart: always

  # Staging ì „ìš© ë°ì´í„°ë² ì´ìŠ¤ (Production ë¯¸ëŸ¬ë§)
  staging-postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: staging_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - staging_postgres_data:/var/lib/postgresql/data
      # Productionê³¼ ë™ì¼í•œ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
      - ./infrastructure/shared-database/postgresql/init:/docker-entrypoint-initdb.d
    restart: always

  # ëª¨ë‹ˆí„°ë§ (Productionê³¼ ë™ì¼)
  prometheus:
    image: prom/prometheus:latest
    volumes:
      - ./infrastructure/monitoring/prometheus/staging.yml:/etc/prometheus/prometheus.yml
    restart: always

  # ì‹¤ì œ ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™ í…ŒìŠ¤íŠ¸ìš©
  external-service-proxy:
    image: nginx:alpine
    volumes:
      - ./docker/nginx/staging-proxy.conf:/etc/nginx/nginx.conf
    ports:
      - "443:443"
    restart: always

volumes:
  staging_postgres_data:
```

## ğŸ§‘â€ğŸ’¼ ê° í™˜ê²½ì—ì„œì˜ í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### **Development í™˜ê²½ì—ì„œ:**
```javascript
// ê°œë°œ í™˜ê²½ í…ŒìŠ¤íŠ¸ - ê¸°ë³¸ ê¸°ëŠ¥ í™•ì¸
describe('Development Environment Tests', () => {
  it('should connect to mock email service', async () => {
    // MailHog ê°™ì€ ê°œë°œìš© ì´ë©”ì¼ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
    expect(emailService.provider).toBe('mailhog');
  });

  it('should use development database', async () => {
    expect(process.env.DATABASE_URL).toContain('dev_db');
  });

  it('should allow CORS from anywhere', async () => {
    expect(corsConfig.origin).toBe('*');
  });
});
```

### **Staging í™˜ê²½ì—ì„œ:**
```javascript
// Staging í™˜ê²½ í…ŒìŠ¤íŠ¸ - Production ì‹œë®¬ë ˆì´ì…˜
describe('Staging Environment Tests', () => {
  it('should connect to real SMTP service', async () => {
    // ì‹¤ì œ SMTP ì„œë¹„ìŠ¤ ì—°ë™ í…ŒìŠ¤íŠ¸
    const result = await emailService.sendTestEmail();
    expect(result.provider).toBe('smtp');
    expect(result.success).toBe(true);
  });

  it('should use production-like database', async () => {
    expect(process.env.DATABASE_URL).toContain('staging_db');
    expect(process.env.NODE_ENV).toBe('production');
  });

  it('should have strict CORS policy', async () => {
    expect(corsConfig.origin).toBe('https://staging.yourdomain.com');
  });

  it('should handle production-level load', async () => {
    // ë¶€í•˜ í…ŒìŠ¤íŠ¸
    const responses = await Promise.all(
      Array(100).fill().map(() => apiClient.get('/api/users'))
    );
    expect(responses.every(r => r.status === 200)).toBe(true);
  });
});
```

### **Production í™˜ê²½ì—ì„œ:**
```javascript
// Production í™˜ê²½ - ëª¨ë‹ˆí„°ë§ ë° í—¬ìŠ¤ì²´í¬ë§Œ
describe('Production Environment Health', () => {
  it('should respond to health checks', async () => {
    const response = await fetch('/health');
    expect(response.status).toBe(200);
  });

  it('should have all security headers', async () => {
    const response = await fetch('/');
    expect(response.headers.get('strict-transport-security')).toBeTruthy();
    expect(response.headers.get('x-frame-options')).toBe('DENY');
  });
});
```

## ğŸ¯ Staging í™˜ê²½ì´ í•„ìš”í•œ ì´ìœ 

### **1. Production ë¬¸ì œ ì‚¬ì „ ë°©ì§€:**
```javascript
// Developmentì—ì„œëŠ” ë¬¸ì œì—†ì—ˆì§€ë§Œ Stagingì—ì„œ ë°œê²¬ë˜ëŠ” ì´ìŠˆë“¤
const issues = [
  'Production í™˜ê²½ ì„¤ì • ì˜¤ë¥˜',
  'ì‹¤ì œ ì™¸ë¶€ API ì—°ë™ ë¬¸ì œ',
  'ë³´ì•ˆ ì •ì±…ìœ¼ë¡œ ì¸í•œ ì ‘ê·¼ ì œí•œ',
  'ì„±ëŠ¥ ë³‘ëª© ì§€ì ',
  'HTTPS í™˜ê²½ì—ì„œë§Œ ë°œìƒí•˜ëŠ” ë¬¸ì œ',
  'ì‹¤ì œ ë°ì´í„° í¬ê¸°ë¡œ ì¸í•œ ë©”ëª¨ë¦¬ ì´ìŠˆ'
];
```

### **2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¦¬ìŠ¤í¬ ê°ì†Œ:**
- **ê³ ê° ë°ì´í„° ë³´í˜¸**: ì‹¤ì œ ë°ì´í„°ë¡œ í…ŒìŠ¤íŠ¸í•˜ì§€ ì•ŠìŒ
- **ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ë°©ì§€**: Production ë°°í¬ ì „ ë§ˆì§€ë§‰ ê²€ì¦
- **ë¹„ìš© ì ˆì•½**: Production ì¥ì• ë¡œ ì¸í•œ ì†ì‹¤ ë°©ì§€

### **3. íŒ€ í˜‘ì—… ê°œì„ :**
- **QAíŒ€**: Productionê³¼ ë™ì¼í•œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸
- **ë¹„ì¦ˆë‹ˆìŠ¤íŒ€**: ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ë¡œ ê²€ì¦
- **DevOpsíŒ€**: ë°°í¬ í”„ë¡œì„¸ìŠ¤ ê²€ì¦

**ê²°ë¡ ì ìœ¼ë¡œ, Stagingì€ "Productionì˜ ì•ˆì „í•œ ë³µì œí’ˆ"ìœ¼ë¡œì„œ ì‹¤ì œ ë°°í¬ ì „ ë§ˆì§€ë§‰ ì•ˆì „ì¥ì¹˜ ì—­í• ì„ í•©ë‹ˆë‹¤!** ğŸ›¡ï¸

===

"""
ë™ì¼í•œ ì½”ë“œë¥¼ ê¸°ë°˜ìœ¼ë¡œ, development ì„œë²„ëŠ” ì½”ë“œ ë³€ê²½ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ë™ê¸°í™”í•˜ë©´ì„œ êµ¬ë™ë˜ê³ , production, staging ì„œë²„ëŠ” ì»´íŒŒì¼ëœ ì½”ë“œë¥¼ ê°ê° ë‹¤ë¥¸ portë¡œ ì„œë¹„ìŠ¤í•˜ë ¤ë©´, ì–´ë–¤ ë°©ë²•ì´ ì¢‹ì„ê¹Œìš”? git branchë¥¼ ì“°ëŠ” ê²ƒë³´ë‹¤ëŠ” portë§Œ ë‹¤ë¥´ê²Œ í•˜ëŠ”ê²Œ ë‚«ê² ì£ ?
"""

ì •ë§ í›Œë¥­í•œ ì ‘ê·¼ ë°©ì‹ì´ë„¤ìš”! ë™ì¼í•œ ì½”ë“œë² ì´ìŠ¤ì—ì„œ í™˜ê²½ë³„ë¡œ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì„œë¹„ìŠ¤í•˜ëŠ” ê²ƒì´ **í›¨ì”¬ íš¨ìœ¨ì **ì…ë‹ˆë‹¤. Git branchë¥¼ ë‚˜ëˆ„ëŠ” ê²ƒë³´ë‹¤ **í¬íŠ¸ ê¸°ë°˜ ë¶„ë¦¬**ê°€ ê´€ë¦¬í•˜ê¸° ì‰½ê³  ì¼ê´€ì„±ë„ ìœ ì§€í•  ìˆ˜ ìˆì–´ìš”.

## ğŸ¯ ìµœì í™”ëœ ë©€í‹° í™˜ê²½ êµ¬ì„± ì „ëµ

### 1. **ì „ì²´ í¬íŠ¸ ë¶„ë°° ê³„íš**

```
ğŸ“‹ í¬íŠ¸ í• ë‹¹ ì²´ê³„:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ì„œë¹„ìŠ¤      â”‚   Dev    â”‚ Staging  â”‚   Prod   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ API Gateway     â”‚   201000   â”‚   3010   â”‚   3020   â”‚
â”‚ Auth Service    â”‚   201011   â”‚   3011   â”‚   3021   â”‚
â”‚ Database Svc    â”‚   3002   â”‚   3012   â”‚   3022   â”‚
â”‚ Management BE   â”‚   3004   â”‚   3014   â”‚   3024   â”‚
â”‚ Management FE   â”‚   3005   â”‚   3015   â”‚   3025   â”‚
â”‚ Project-1 BE    â”‚   4001   â”‚   4011   â”‚   4021   â”‚
â”‚ Project-1 FE    â”‚   4005   â”‚   4015   â”‚   4025   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ”¢ íŒ¨í„´: Base_Port + (Environment_Offset * 10)
- Development: +0  (201000, 201011, 3002...)
- Staging:     +10 (3010, 3011, 3012...)
- Production:  +20 (3020, 3021, 3022...)
```

### 2. **í†µí•© Docker Compose êµ¬ì„±**

#### **docker-compose.yml (ê¸°ë³¸ - ëª¨ë“  í™˜ê²½ ë™ì‹œ ì‹¤í–‰)**
```yaml
version: '3.8'

services:
  # ================================
  # ê³µìœ  ì¸í”„ë¼ (ëª¨ë“  í™˜ê²½ ê³µí†µ)
  # ================================
  shared-postgres:
    image: postgres:15
    container_name: shared-postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./infrastructure/shared-database/postgresql/init:/docker-entrypoint-initdb.d
    ports:
      - "5432:5432"
    networks:
      - infrastructure

  shared-redis:
    image: redis:7-alpine
    container_name: shared-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - infrastructure

  # ================================
  # DEVELOPMENT í™˜ê²½ (ì½”ë“œ ë™ê¸°í™”)
  # ================================
  auth-service-dev:
    build:
      context: ./infrastructure/auth-service
      dockerfile: ../docker/dockerfiles/backend.dev.Dockerfile
    container_name: auth-service-dev
    environment:
      NODE_ENV: development
      ENVIRONMENT: development
      PORT: 201000
      DATABASE_URL: postgresql://postgres:${POSTGRES_PASSWORD}@shared-postgres:5432/auth_dev_db
      REDIS_URL: redis://shared-redis:6379
      JWT_ACCESS_SECRET: ${JWT_ACCESS_SECRET_DEV}
    volumes:
      # ğŸ”¥ ì‹¤ì‹œê°„ ì½”ë“œ ë™ê¸°í™”
      - ./infrastructure/auth-service:/app
      - /app/node_modules
      - auth_dev_node_modules:/app/node_modules
    ports:
      - "201011:201000"
    command: npm run dev
    networks:
      - infrastructure
    depends_on:
      - shared-postgres
      - shared-redis
    restart: unless-stopped

  management-frontend-dev:
    build:
      context: ./management-hub/frontend
      dockerfile: ../../docker/dockerfiles/frontend.dev.Dockerfile
    container_name: management-frontend-dev
    environment:
      NODE_ENV: development
      ENVIRONMENT: development
      NEXT_PUBLIC_API_REST_URL: http://localhost:3004
      NEXT_PUBLIC_GATEWAY_URL: http://localhost:201000
      CHOKIDAR_USEPOLLING: 1
      WATCHPACK_POLLING: 1
    volumes:
      # ğŸ”¥ ì‹¤ì‹œê°„ ì½”ë“œ ë™ê¸°í™” + Hot Reload
      - ./management-hub/frontend:/app
      - /app/node_modules
      - /app/.next
      - mgmt_fe_dev_node_modules:/app/node_modules
    ports:
      - "3005:201000"
    command: npm run dev
    networks:
      - infrastructure
    restart: unless-stopped

  # ================================
  # STAGING í™˜ê²½ (ì»´íŒŒì¼ëœ ì½”ë“œ)
  # ================================
  auth-service-staging:
    build:
      context: ./infrastructure/auth-service
      dockerfile: ../docker/dockerfiles/backend.prod.Dockerfile
      args:
        NODE_ENV: production
    container_name: auth-service-staging
    environment:
      NODE_ENV: production
      ENVIRONMENT: staging
      PORT: 201000
      DATABASE_URL: postgresql://postgres:${POSTGRES_PASSWORD}@shared-postgres:5432/auth_staging_db
      REDIS_URL: redis://shared-redis:6379
      JWT_ACCESS_SECRET: ${JWT_ACCESS_SECRET_STAGING}
    ports:
      - "3011:201000"
    command: npm start
    networks:
      - infrastructure
    depends_on:
      - shared-postgres
      - shared-redis
    restart: always
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M

  management-frontend-staging:
    build:
      context: ./management-hub/frontend
      dockerfile: ../../docker/dockerfiles/frontend.prod.Dockerfile
      args:
        NODE_ENV: production
        NEXT_PUBLIC_API_REST_URL: http://localhost:3014
        NEXT_PUBLIC_GATEWAY_URL: http://localhost:3010
    container_name: management-frontend-staging
    environment:
      NODE_ENV: production
      ENVIRONMENT: staging
      PORT: 201000
    ports:
      - "3015:201000"
    command: npm start
    networks:
      - infrastructure
    restart: always

  # ================================
  # PRODUCTION í™˜ê²½ (ì»´íŒŒì¼ëœ ì½”ë“œ)
  # ================================
  auth-service-prod:
    build:
      context: ./infrastructure/auth-service
      dockerfile: ../docker/dockerfiles/backend.prod.Dockerfile
      args:
        NODE_ENV: production
    container_name: auth-service-prod
    environment:
      NODE_ENV: production
      ENVIRONMENT: production
      PORT: 201000
      DATABASE_URL: postgresql://postgres:${POSTGRES_PASSWORD}@shared-postgres:5432/auth_prod_db
      REDIS_URL: redis://shared-redis:6379
      JWT_ACCESS_SECRET: ${JWT_ACCESS_SECRET_PROD}
    ports:
      - "3021:201000"
    command: npm start
    networks:
      - infrastructure
    depends_on:
      - shared-postgres
      - shared-redis
    restart: always
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G

  management-frontend-prod:
    build:
      context: ./management-hub/frontend
      dockerfile: ../../docker/dockerfiles/frontend.prod.Dockerfile
      args:
        NODE_ENV: production
        NEXT_PUBLIC_API_REST_URL: http://localhost:3024
        NEXT_PUBLIC_GATEWAY_URL: http://localhost:3020
    container_name: management-frontend-prod
    environment:
      NODE_ENV: production
      ENVIRONMENT: production
      PORT: 201000
    ports:
      - "3025:201000"
    command: npm start
    networks:
      - infrastructure
    restart: always

volumes:
  postgres_data:
  redis_data:
  # ê°œë°œ í™˜ê²½ ì „ìš© node_modules ë³¼ë¥¨ë“¤
  auth_dev_node_modules:
  mgmt_fe_dev_node_modules:

networks:
  infrastructure:
    driver: bridge
```

### 3. **í™˜ê²½ë³„ ìŠ¤ë§ˆíŠ¸ ê´€ë¦¬ ìŠ¤í¬ë¦½íŠ¸**

#### **scripts/multi-env-manager.sh**
```bash
#!/bin/bash

set -e

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
NC='\033[0m'

print_header() {
    echo -e "${PURPLE}"
    echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
    echo "â•‘                        ğŸ³ ë©€í‹° í™˜ê²½ Docker ê´€ë¦¬ì                             â•‘"
    echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo -e "${NC}"
}

print_info() {
    echo -e "${BLUE}â„¹ï¸  $1${NC}"
}

print_success() {
    echo -e "${GREEN}âœ… $1${NC}"
}

print_warning() {
    echo -e "${YELLOW}âš ï¸  $1${NC}"
}

print_error() {
    echo -e "${RED}âŒ $1${NC}"
}

# ì„œë¹„ìŠ¤ ê·¸ë£¹ ì •ì˜
declare -A SERVICE_GROUPS=(
    ["infrastructure"]="shared-postgres shared-redis"
    ["dev"]="auth-service-dev database-service-dev api-gateway-dev management-backend-dev management-frontend-dev"
    ["staging"]="auth-service-staging database-service-staging api-gateway-staging management-backend-staging management-frontend-staging"
    ["prod"]="auth-service-prod database-service-prod api-gateway-prod management-backend-prod management-frontend-prod"
    ["all-dev"]="infrastructure dev"
    ["all-staging"]="infrastructure staging"
    ["all-prod"]="infrastructure prod"
    ["everything"]="infrastructure dev staging prod"
)

# í¬íŠ¸ ì •ë³´
declare -A PORT_INFO=(
    ["dev"]="Development: 201011-3005, 4001-4005 (Hot Reload í™œì„±í™”)"
    ["staging"]="Staging: 3011-3015, 4011-4015 (ì»´íŒŒì¼ëœ ì½”ë“œ)"
    ["prod"]="Production: 3021-3025, 4021-4025 (ìµœì í™”ëœ ì½”ë“œ)"
)

# ì‚¬ìš©ë²•
usage() {
    print_header
    echo "ì‚¬ìš©ë²•: $0 [ACTION] [TARGET] [OPTIONS]"
    echo ""
    echo "ğŸ¯ ACTIONS:"
    echo "  start                     ì„œë¹„ìŠ¤ ì‹œì‘"
    echo "  stop                      ì„œë¹„ìŠ¤ ì¤‘ì§€"
    echo "  restart                   ì„œë¹„ìŠ¤ ì¬ì‹œì‘"
    echo "  rebuild                   ì´ë¯¸ì§€ ë¦¬ë¹Œë“œ í›„ ì‹œì‘"
    echo "  logs                      ë¡œê·¸ í™•ì¸"
    echo "  status                    ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸"
    echo "  clean                     ì¤‘ì§€ í›„ ì´ë¯¸ì§€/ë³¼ë¥¨ ì •ë¦¬"
    echo ""
    echo "ğŸ¨ TARGETS:"
    echo "  infrastructure            ê³µìœ  ì¸í”„ë¼ (DB, Redis)"
    echo "  dev                       ê°œë°œ í™˜ê²½ (Hot Reload)"
    echo "  staging                   ìŠ¤í…Œì´ì§• í™˜ê²½ (ì»´íŒŒì¼)"
    echo "  prod                      í”„ë¡œë•ì…˜ í™˜ê²½ (ìµœì í™”)"
    echo "  all-dev                   ì¸í”„ë¼ + ê°œë°œ í™˜ê²½"
    echo "  all-staging              ì¸í”„ë¼ + ìŠ¤í…Œì´ì§• í™˜ê²½"
    echo "  all-prod                 ì¸í”„ë¼ + í”„ë¡œë•ì…˜ í™˜ê²½"
    echo "  everything               ëª¨ë“  í™˜ê²½"
    echo ""
    echo "ğŸŒ PORT ì •ë³´:"
    for env in dev staging prod; do
        echo "  ${PORT_INFO[$env]}"
    done
    echo ""
    echo "ğŸ’¡ ì‚¬ìš© ì˜ˆì‹œ:"
    echo "  $0 start infrastructure   # ì¸í”„ë¼ë§Œ ì‹œì‘"
    echo "  $0 start all-dev          # ê°œë°œ í™˜ê²½ ì „ì²´ ì‹œì‘"
    echo "  $0 rebuild staging        # ìŠ¤í…Œì´ì§• í™˜ê²½ ë¦¬ë¹Œë“œ"
    echo "  $0 logs dev auth-service-dev  # ê°œë°œ í™˜ê²½ ì¸ì¦ ì„œë¹„ìŠ¤ ë¡œê·¸"
    echo "  $0 status everything      # ëª¨ë“  ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸"
}

# ì„œë¹„ìŠ¤ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
get_services() {
    local target=$1
    local services=""
    
    if [[ ${SERVICE_GROUPS[$target]+_} ]]; then
        # ê·¸ë£¹ì¸ ê²½ìš°
        local group_services="${SERVICE_GROUPS[$target]}"
        for group in $group_services; do
            if [[ ${SERVICE_GROUPS[$group]+_} ]]; then
                # ì¤‘ì²© ê·¸ë£¹
                services="$services ${SERVICE_GROUPS[$group]}"
            else
                services="$services $group"
            fi
        done
    else
        # ë‹¨ì¼ ì„œë¹„ìŠ¤
        services=$target
    fi
    
    echo $services
}

# Docker Compose ëª…ë ¹ ì‹¤í–‰
run_compose() {
    local action=$1
    local services=$2
    shift 2
    
    docker-compose $action $services "$@"
}

# í™˜ê²½ë³„ ë¹Œë“œ ìµœì í™”
optimize_build() {
    local target=$1
    
    case $target in
        *dev*)
            print_info "ê°œë°œ í™˜ê²½ ë¹Œë“œ: ìºì‹œ í™œìš©, ê°œë°œ ë„êµ¬ í¬í•¨"
            ;;
        *staging*)
            print_info "ìŠ¤í…Œì´ì§• í™˜ê²½ ë¹Œë“œ: í”„ë¡œë•ì…˜ ëª¨ë“œ, ìµœì í™” í™œì„±í™”"
            export NODE_ENV=production
            ;;
        *prod*)
            print_info "í”„ë¡œë•ì…˜ í™˜ê²½ ë¹Œë“œ: ìµœëŒ€ ìµœì í™”, ë³´ì•ˆ ê°•í™”"
            export NODE_ENV=production
            export BUILD_OPTIMIZATION=true
            ;;
    esac
}

# ë©”ì¸ ë¡œì§
main() {
    if [ $# -lt 2 ]; then
        usage
        exit 1
    fi
    
    local action=$1
    local target=$2
    shift 2
    
    # í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™
    cd "$(dirname "$0")/.."
    
    # í™˜ê²½ íŒŒì¼ ë¡œë“œ
    if [ -f ".env" ]; then
        source .env
    fi
    
    # ì„œë¹„ìŠ¤ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    local services=$(get_services "$target")
    
    print_header
    print_info "Target: $target"
    print_info "Services: $services"
    print_info "Action: $action"
    echo ""
    
    case $action in
        "start")
            print_info "ğŸš€ ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
            
            # ì¸í”„ë¼ ë¨¼ì € ì‹œì‘ (ë‹¤ë¥¸ í™˜ê²½ì´ í¬í•¨ëœ ê²½ìš°)
            if [[ $target == *"all-"* ]] || [[ $target == "everything" ]]; then
                print_info "ğŸ“¡ ì¸í”„ë¼ ì„œë¹„ìŠ¤ë¥¼ ë¨¼ì € ì‹œì‘í•©ë‹ˆë‹¤..."
                run_compose up -d ${SERVICE_GROUPS["infrastructure"]}
                sleep 5
            fi
            
            run_compose up -d $services
            print_success "ì„œë¹„ìŠ¤ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
            
            # ì ‘ì† ì •ë³´ í‘œì‹œ
            show_service_info "$target"
            ;;
            
        "stop")
            print_info "ğŸ›‘ ì„œë¹„ìŠ¤ë¥¼ ì¤‘ì§€í•©ë‹ˆë‹¤..."
            run_compose down $services
            print_success "ì„œë¹„ìŠ¤ê°€ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤!"
            ;;
            
        "restart")
            print_info "ğŸ”„ ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘í•©ë‹ˆë‹¤..."
            run_compose restart $services
            print_success "ì„œë¹„ìŠ¤ê°€ ì¬ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!"
            ;;
            
        "rebuild")
            print_info "ğŸ”¨ ì´ë¯¸ì§€ë¥¼ ë¦¬ë¹Œë“œí•©ë‹ˆë‹¤..."
            optimize_build "$target"
            
            # ìºì‹œ ì‚¬ìš© ì—¬ë¶€ ê²°ì •
            local build_args="--build"
            if [[ $target == *"prod"* ]] || [[ $target == *"staging"* ]]; then
                build_args="--build --no-cache"
                print_warning "í”„ë¡œë•ì…˜/ìŠ¤í…Œì´ì§• í™˜ê²½: ìºì‹œ ì—†ì´ ë¹Œë“œ"
            fi
            
            run_compose up -d $build_args $services
            print_success "ë¦¬ë¹Œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
            
            show_service_info "$target"
            ;;
            
        "logs")
            local service_name=${1:-""}
            if [ -n "$service_name" ]; then
                print_info "ğŸ“‹ $service_name ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤..."
                run_compose logs -f --tail=100 $service_name
            else
                print_info "ğŸ“‹ ëª¨ë“  ì„œë¹„ìŠ¤ ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤..."
                run_compose logs -f --tail=50 $services
            fi
            ;;
            
        "status")
            print_info "ğŸ“Š ì„œë¹„ìŠ¤ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤..."
            echo ""
            docker-compose ps $services
            echo ""
            
            # ìƒì„¸ ìƒíƒœ ì •ë³´
            for service in $services; do
                local status=$(docker-compose ps -q $service | xargs -r docker inspect --format='{{.State.Status}}' 2>/dev/null || echo "not found")
                case $status in
                    "running")
                        print_success "$service: ì‹¤í–‰ ì¤‘"
                        ;;
                    "exited")
                        print_error "$service: ì¤‘ì§€ë¨"
                        ;;
                    "not found")
                        print_warning "$service: ì»¨í…Œì´ë„ˆ ì—†ìŒ"
                        ;;
                    *)
                        print_warning "$service: $status"
                        ;;
                esac
            done
            ;;
            
        "clean")
            print_warning "âš ï¸  ì„œë¹„ìŠ¤ ì¤‘ì§€ ë° ì •ë¦¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."
            read -p "ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N): " -n 1 -r
            echo ""
            
            if [[ $REPLY =~ ^[Yy]$ ]]; then
                run_compose down $services
                docker-compose down --volumes --remove-orphans
                docker system prune -f
                print_success "ì •ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
            else
                print_info "ì‘ì—…ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤."
            fi
            ;;
            
        *)
            print_error "ì§€ì›í•˜ì§€ ì•ŠëŠ” ì•¡ì…˜: $action"
            usage
            exit 1
            ;;
    esac
}

# ì„œë¹„ìŠ¤ ì ‘ì† ì •ë³´ í‘œì‹œ
show_service_info() {
    local target=$1
    
    echo ""
    print_success "ğŸŒ ì„œë¹„ìŠ¤ ì ‘ì† ì •ë³´:"
    
    case $target in
        *"dev"*)
            echo "  ğŸ”¥ Development (Hot Reload):"
            echo "     â€¢ Management Hub: http://localhost:3005"
            echo "     â€¢ API Gateway: http://localhost:201000"
            echo "     â€¢ Auth Service: http://localhost:201011"
            ;;
        *"staging"*)
            echo "  ğŸ§ª Staging (Compiled):"
            echo "     â€¢ Management Hub: http://localhost:3015"
            echo "     â€¢ API Gateway: http://localhost:3010"
            echo "     â€¢ Auth Service: http://localhost:3011"
            ;;
        *"prod"*)
            echo "  ğŸš€ Production (Optimized):"
            echo "     â€¢ Management Hub: http://localhost:3025"
            echo "     â€¢ API Gateway: http://localhost:3020"
            echo "     â€¢ Auth Service: http://localhost:3021"
            ;;
        "everything")
            echo "  ğŸ”¥ Development: http://localhost:3005 (Hot Reload)"
            echo "  ğŸ§ª Staging: http://localhost:3015 (Compiled)"
            echo "  ğŸš€ Production: http://localhost:3025 (Optimized)"
            ;;
    esac
    
    echo ""
    print_info "ğŸ’¡ ë¡œê·¸ í™•ì¸: $0 logs $target [service-name]"
    print_info "ğŸ“Š ìƒíƒœ í™•ì¸: $0 status $target"
}

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
main "$@"
```

### 4. **í™˜ê²½ë³„ ìµœì í™”ëœ Dockerfile**

#### **ê°œë°œìš© Dockerfile (dockerfiles/backend.dev.Dockerfile)**
```dockerfile
FROM node:18-alpine

# ê°œë°œ ë„êµ¬ ì„¤ì¹˜
RUN apk add --no-cache git python3 make g++

WORKDIR /app

# íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ê°œë°œ ì˜ì¡´ì„± í¬í•¨)
COPY package*.json ./
RUN npm ci --include=dev

# ê¸€ë¡œë²Œ ê°œë°œ ë„êµ¬
RUN npm install -g nodemon concurrently

# ê°œë°œìš© ì‚¬ìš©ì ìƒì„±
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001 -G nodejs

# ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ (ë³¼ë¥¨ ë§ˆìš´íŠ¸ë¡œ ëŒ€ì²´ë¨)
COPY . .
RUN chown -R nodejs:nodejs /app

USER nodejs

EXPOSE 201000

# ğŸ”¥ í•« ë¦¬ë¡œë“œ ëª…ë ¹
CMD ["npm", "run", "dev"]
```

#### **í”„ë¡œë•ì…˜ìš© Dockerfile (dockerfiles/backend.prod.Dockerfile)**
```dockerfile
# ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ
FROM node:18-alpine AS dependencies
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production && npm cache clean --force

FROM node:18-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci
COPY . .

# ğŸš€ í”„ë¡œë•ì…˜ ë¹Œë“œ (í™˜ê²½ì— ë”°ë¥¸ ìµœì í™”)
ARG NODE_ENV=production
ENV NODE_ENV=${NODE_ENV}

# TypeScript ì»´íŒŒì¼ (ìˆëŠ” ê²½ìš°)
RUN npm run build 2>/dev/null || echo "No build script found"

# ëŸ°íƒ€ì„ ìŠ¤í…Œì´ì§€
FROM node:18-alpine AS runtime

# ë³´ì•ˆì„ ìœ„í•œ non-root ì‚¬ìš©ì
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001 -G nodejs

WORKDIR /app

# í•„ìš”í•œ íŒŒì¼ë§Œ ë³µì‚¬
COPY --from=dependencies --chown=nodejs:nodejs /app/node_modules ./node_modules
COPY --from=builder --chown=nodejs:nodejs /app .

USER nodejs

EXPOSE 201000

# ğŸš€ í”„ë¡œë•ì…˜ ì‹¤í–‰
CMD ["npm", "start"]
```

### 5. **í™˜ê²½ë³„ package.json ìŠ¤í¬ë¦½íŠ¸**

```json
{
  "scripts": {
    "dev": "nodemon --watch src --ext js,ts,json,graphql --exec node src/app.js",
    "dev:debug": "nodemon --inspect=0.0.0.0:9229 --watch src --exec node src/app.js",
    "start": "node src/app.js",
    "build": "npm run build:clean && npm run build:compile",
    "build:clean": "rm -rf dist",
    "build:compile": "tsc || babel src --out-dir dist --extensions '.ts,.js'",
    "test": "jest",
    "test:watch": "jest --watch",
    "lint": "eslint src --ext .js,.ts",
    "lint:fix": "eslint src --ext .js,.ts --fix"
  },
  "nodemonConfig": {
    "watch": ["src"],
    "ext": "js,ts,json,graphql",
    "ignore": ["node_modules", "*.test.js", "dist"],
    "delay": 1000,
    "env": {
      "NODE_ENV": "development"
    }
  }
}
```

### 6. **í™˜ê²½ë³„ ì„¤ì • ê´€ë¦¬**

#### **config/index.js (ë™ì  í™˜ê²½ ì„¤ì •)**
```javascript
const path = require('path');

// í™˜ê²½ë³„ ì„¤ì • ë¡œë“œ
const loadConfig = () => {
  const environment = process.env.ENVIRONMENT || 'development';
  const nodeEnv = process.env.NODE_ENV || 'development';
  
  console.log(`ğŸ¯ Environment: ${environment}, Node ENV: ${nodeEnv}`);
  
  const baseConfig = {
    environment,
    nodeEnv,
    port: process.env.PORT || 201000,
    
    // ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
    database: {
      url: process.env.DATABASE_URL,
      pool: {
        min: nodeEnv === 'production' ? 5 : 2,
        max: nodeEnv === 'production' ? 20 : 10
      }
    },
    
    // Redis ì„¤ì •
    redis: {
      url: process.env.REDIS_URL || 'redis://localhost:6379',
      keyPrefix: `app:${environment}:`
    },
    
    // JWT ì„¤ì •
    jwt: {
      accessSecret: process.env.JWT_ACCESS_SECRET,
      refreshSecret: process.env.JWT_REFRESH_SECRET,
      accessExpiresIn: nodeEnv === 'production' ? '15m' : '1h',
      refreshExpiresIn: '7d'
    }
  };
  
  // í™˜ê²½ë³„ íŠ¹ë³„ ì„¤ì •
  const envConfigs = {
    development: {
      logging: {
        level: 'debug',
        prettyPrint: true
      },
      cors: {
        origin: '*',
        credentials: true
      },
      rateLimiting: {
        enabled: false
      },
      hotReload: true,
      debugMode: true
    },
    
    staging: {
      logging: {
        level: 'info',
        prettyPrint: false
      },
      cors: {
        origin: ['http://localhost:3015', 'https://staging.yourdomain.com'],
        credentials: true
      },
      rateLimiting: {
        enabled: true,
        windowMs: 15 * 60 * 1000, // 15 minutes
        max: 1000 // requests per window
      },
      monitoring: {
        enabled: true,
        metricsPath: '/metrics'
      }
    },
    
    production: {
      logging: {
        level: 'warn',
        prettyPrint: false,
        file: '/var/log/app.log'
      },
      cors: {
        origin: ['https://yourdomain.com'],
        credentials: true
      },
      rateLimiting: {
        enabled: true,
        windowMs: 15 * 60 * 1000,
        max: 500
      },
      security: {
        helmet: true,
        https: true,
        hsts: true
      },
      monitoring: {
        enabled: true,
        metricsPath: '/metrics',
        alerting: true
      },
      performance: {
        compression: true,
        caching: true
      }
    }
  };
  
  return {
    ...baseConfig,
    ...envConfigs[environment]
  };
};

module.exports = loadConfig();
```

### 7. **ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ**

#### **ì¼ìƒì ì¸ ê°œë°œ ì›Œí¬í”Œë¡œìš°:**
```bash
# 1. ê°œë°œ í™˜ê²½ë§Œ ì‹œì‘ (Hot Reload)
./scripts/multi-env-manager.sh start all-dev
# â†’ http://localhost:3005 (ê°œë°œ)

# 2. ì½”ë“œ ë³€ê²½í•˜ë©´ì„œ ê°œë°œ...
# (íŒŒì¼ ì €ì¥ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œì‘ë¨)

# 3. ìŠ¤í…Œì´ì§•ì—ì„œ í…ŒìŠ¤íŠ¸
./scripts/multi-env-manager.sh rebuild staging
# â†’ http://localhost:3015 (ìŠ¤í…Œì´ì§•)

# 4. í”„ë¡œë•ì…˜ ë°°í¬ ì „ ìµœì¢… í™•ì¸
./scripts/multi-env-manager.sh rebuild prod
# â†’ http://localhost:3025 (í”„ë¡œë•ì…˜)

# 5. ëª¨ë“  í™˜ê²½ ë™ì‹œ ì‹¤í–‰ (ë°ëª¨/ë¹„êµìš©)
./scripts/multi-env-manager.sh start everything
# â†’ 3ê°œ í™˜ê²½ ëª¨ë‘ ë™ì‹œ ì‹¤í–‰

# 6. ë¡œê·¸ í™•ì¸
./scripts/multi-env-manager.sh logs dev auth-service-dev
./scripts/multi-env-manager.sh logs staging

# 7. ìƒíƒœ í™•ì¸
./scripts/multi-env-manager.sh status everything
```

## ğŸ¯ ì´ ë°©ì‹ì˜ ì¥ì 

### **1. ì¼ê´€ì„± ë³´ì¥:**
- âœ… ë™ì¼í•œ ì½”ë“œë² ì´ìŠ¤ ì‚¬ìš©
- âœ… í™˜ê²½ë³„ ì°¨ì´ì ì€ ì„¤ì •ë§Œìœ¼ë¡œ ê´€ë¦¬
- âœ… Git branch ë³µì¡ì„± ì œê±°

### **2. ê°œë°œ íš¨ìœ¨ì„±:**
- âœ… Development: ì¦‰ì‹œ ë³€ê²½ì‚¬í•­ ë°˜ì˜
- âœ… Staging/Production: ì»´íŒŒì¼ëœ ì•ˆì •ì  ì½”ë“œ
- âœ… í¬íŠ¸ë§Œ ë‹¤ë¥´ë¯€ë¡œ ë™ì‹œ ì‹¤í–‰ ê°€ëŠ¥

### **3. ìš´ì˜ í¸ì˜ì„±:**
- âœ… í•œ ë²ˆì˜ ëª…ë ¹ìœ¼ë¡œ í™˜ê²½ë³„ ê´€ë¦¬
- âœ… í™˜ê²½ ê°„ ì‰¬ìš´ ë¹„êµ ë° í…ŒìŠ¤íŠ¸
- âœ… í”„ë¡œë•ì…˜ ë°°í¬ ì „ ìµœì¢… ê²€ì¦ ê°€ëŠ¥

### **4. ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„±:**
- âœ… ê°œë°œìš©: ì‹¤ì‹œê°„ ë™ê¸°í™”ë¡œ ë¹ ë¥¸ í”¼ë“œë°±
- âœ… ìš´ì˜ìš©: ìµœì í™”ëœ ì»´íŒŒì¼ ì½”ë“œë¡œ ì„±ëŠ¥ í–¥ìƒ
- âœ… ê³µìœ  ì¸í”„ë¼ë¡œ ë¦¬ì†ŒìŠ¤ ì ˆì•½

ì´ ë°©ì‹ì´ Git branch ë¶„ë¦¬ë³´ë‹¤ í›¨ì”¬ ê´€ë¦¬í•˜ê¸° ì‰½ê³  ì‹¤ìš©ì ì…ë‹ˆë‹¤! ğŸš€